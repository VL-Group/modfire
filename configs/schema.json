{"$schema": "http://json-schema.org/draft-07/schema#", "definitions": {"ModelSchema": {"properties": {"key": {"title": "key", "type": "string", "description": "A unique key used to retrieve in ModelRegistry."}, "params": {"title": "params", "type": "object", "default": {}, "description": "Corresponding funcation call parameters. So the whole call is `registry.get(key)(**params)`.", "additionalProperties": {}}, "temperature": {"type": "object", "$ref": "#/definitions/GeneralSchema", "description": "A spec of temperature tuning schdeduler."}}, "type": "object", "required": ["key"], "additionalProperties": false}, "GeneralSchema": {"properties": {"key": {"title": "key", "type": "string", "default": null, "description": "A unique key used to retrieve in registry. For example, given `Lamb` for optimizers, it will check `OptimRegistry` and find the optimizer `apex.optim.FusedLAMB`."}, "params": {"title": "params", "type": "object", "default": {}, "description": "Corresponding funcation call parameters. So the whole call is `registry.get(key)(**params)`.", "additionalProperties": {}}}, "type": "object", "required": ["key"], "additionalProperties": false}, "TrainSchema": {"properties": {"criterion": {"type": "object", "$ref": "#/definitions/GeneralSchema", "description": "Loss function used for training."}, "database": {"type": "object", "$ref": "#/definitions/DatasetSchema", "description": "A spec to load images per line for evalution database."}, "earlyStop": {"title": "earlyStop", "type": "integer", "description": "Early stop after how many evaluations.", "exclusiveMinimum": 0}, "epoch": {"title": "epoch", "type": "integer", "description": "Total training epochs.", "exclusiveMinimum": 0}, "externalLib": {"title": "externalLib", "type": ["array", "null"], "default": [], "description": "External libraries used for training. All python files in `externalLib` will be imported as modules. In this way, you could extend registries.", "items": {"title": "externalLib", "type": "string"}}, "gpu": {"type": "object", "$ref": "#/definitions/GPUSchema", "description": "GPU configs for training."}, "hooks": {"title": "hooks", "type": ["array", "null"], "default": [], "description": "Hooks used for training. Key is used to retrieve hook from `LBHash.train.hooks`.", "items": {"type": "object", "$ref": "#/definitions/GeneralSchema"}}, "numReturns": {"title": "numReturns", "type": "integer", "description": "Rank list return number of samples.", "exclusiveMinimum": 0}, "optim": {"type": "object", "$ref": "#/definitions/GeneralSchema", "description": "Optimizer used for training. As for current we have `Adam` and `Lamb`."}, "querySet": {"type": "object", "$ref": "#/definitions/DatasetSchema", "description": "A spec to load images per line for evalution query."}, "saveDir": {"title": "saveDir", "type": "string", "description": "A dir path to save model checkpoints, TensorBoard messages and logs."}, "schdr": {"type": "object", "$ref": "#/definitions/GeneralSchema", "description": "Learning rate scheduler used for training. As for current we have `ReduceLROnPlateau`, `Exponential`, `MultiStep`, `OneCycle` and all schedulers defined in `modfire.train.lrSchedulers`."}, "trainSet": {"type": "object", "$ref": "#/definitions/DatasetSchema", "description": "A spec to load images per line for training."}, "trainer": {"title": "trainer", "type": "string", "default": "BaseTrainer", "description": "A key to retrieve from TrainerBuilder, default is `BaseTrainer`."}, "valFreq": {"title": "valFreq", "type": "integer", "description": "Run validation after every `valFreq` epochs.", "exclusiveMinimum": 0}}, "type": "object", "required": ["criterion", "database", "earlyStop", "epoch", "gpu", "numReturns", "optim", "querySet", "saveDir", "schdr", "trainSet", "valFreq"], "additionalProperties": false}, "DatasetSchema": {"properties": {"key": {"title": "key", "type": "string", "description": "A unique key used to retrieve in DatasetRegistry."}, "params": {"title": "params", "type": "object", "default": {}, "description": "Corresponding funcation call parameters. So the whole call is `registry.get(key)(**params)`.", "additionalProperties": {}}, "pipeline": {"type": "object", "$ref": "#/definitions/GeneralSchema", "description": "A spec of data loading pipeline."}}, "type": "object", "required": ["key"], "additionalProperties": false}, "GPUSchema": {"properties": {"gpus": {"title": "gpus", "type": "integer", "description": "Number of gpus for training. This affects the `world size` of PyTorch DDP.", "exclusiveMinimum": 0}, "vRam": {"title": "vRam", "type": "integer", "description": "Minimum VRam required for each gpu. Set it to `-1` to use all gpus."}, "wantsMore": {"title": "wantsMore", "type": "boolean", "description": "Set to `true` to use all visible gpus and all VRams and ignore `gpus` and `vRam`."}}, "type": "object", "required": ["gpus", "vRam", "wantsMore"], "additionalProperties": false}, "ConfigSchema": {"properties": {"model": {"type": "object", "$ref": "#/definitions/ModelSchema", "description": "Model to use. Avaliable params are e.g. `backbone`, `bits` and `hashMethod`."}, "summary": {"title": "summary", "type": "string", "description": "The overall summary to describe method, bits, training set, etc. Strict format: `{bits}bits_{model_type}_{method}_{backbone}_{trainset}_{optional_comments}`. `model_type` can be found in `modfire.model.base`."}, "train": {"type": "object", "$ref": "#/definitions/TrainSchema", "description": "Training configs."}}, "type": "object", "required": ["model", "summary", "train"], "additionalProperties": false}}, "$ref": "#/definitions/ConfigSchema"}